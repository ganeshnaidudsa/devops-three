name: Deploy Backend
on:
    push:
        branches:
            - main

jobs:
    redeploy:
        runs-on: ubuntu-latest
        name: redeploy-everything
        steps:
            - run: |
                echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/ssh_key
                chmod 700 ~/ssh_key
                ssh -o StrictHostKeyChecking=no -i ~/ssh_key root@139.59.58.88 -t "
                cd ~/devops-three && \
                git pull origin main && \
                npm install && \
                npm run build && \
                pm2 reload backend || pm2 start npm --name "backend" -- run dev"


                  
